---
import albumDataJson from '../data/albumData.json';
import { loadTracksWithLyrics, loadDefaultLyrics } from '../utils/lyrics-loader';
import Analytics from '@vercel/analytics/astro';

const albumData = albumDataJson;
const tracksWithLyrics = await loadTracksWithLyrics(albumData);
const defaultLyricsHtml = await loadDefaultLyrics();
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>{albumData.title} - {albumData.artist}</title>
		<meta name="description" content={albumData.description} />
		<meta name="keywords" content={albumData.keywords.join(', ')} />
		<link rel="canonical" href={albumData.url} />
		
		<!-- Open Graph / Facebook -->
		<meta property="og:type" content="music.album" />
		<meta property="og:url" content={albumData.url} />
		<meta property="og:title" content={`${albumData.title} - ${albumData.artist}`} />
		<meta property="og:description" content={albumData.description} />
		<meta property="og:image" content={`${albumData.url}${albumData.coverImage}`} />
		<meta property="music:album" content={albumData.title} />
		<meta property="music:musician" content={albumData.artist} />
		<meta property="music:release_date" content={albumData.releaseDate} />
		
		<!-- Twitter Card -->
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:url" content={albumData.url} />
		<meta name="twitter:title" content={`${albumData.title} - ${albumData.artist}`} />
		<meta name="twitter:description" content={albumData.description} />
		<meta name="twitter:image" content={`${albumData.url}${albumData.coverImage}`} />
		
		<!-- JSON-LD Structured Data -->
		<script type="application/ld+json" set:html={JSON.stringify({
			"@context": "https://schema.org",
			"@type": "MusicAlbum",
			"name": albumData.title,
			"byArtist": {
				"@type": "MusicGroup",
				"name": albumData.artist
			},
			"datePublished": albumData.releaseDate,
			"genre": albumData.genre,
			"description": albumData.description,
			"image": `${albumData.url}${albumData.coverImage}`,
			"url": albumData.url,
			"recordLabel": albumData.label,
			"duration": `PT${albumData.duration.replace(':', 'M')}S`,
			"track": tracksWithLyrics.map((track, index) => ({
				"@type": "MusicRecording",
				"@id": `${albumData.url}#track-${track.id}`,
				"name": track.title,
				"byArtist": {
					"@type": "MusicGroup",
					"name": albumData.artist
				},
				"duration": `PT${track.duration.replace(':', 'M')}S`,
				"trackNumber": track.id,
				"inAlbum": {
					"@type": "MusicAlbum",
					"name": albumData.title
				},
				"audio": {
					"@type": "AudioObject",
					"contentUrl": `${albumData.url}${track.url}`,
					"encodingFormat": "audio/mpeg"
				}
			}))
		})} />
		<link rel="stylesheet" href="/css/styles.css">
		{tracksWithLyrics.map((track) => (
			<link rel="preload" href={track.url} as="audio" type="audio/mp3" />
		))}
		<script define:vars={{ albumData: { ...albumData, tracks: tracksWithLyrics } }}>
			window.albumData = albumData;
		</script>
		<script src="/js/youtube-toggle.js" is:inline></script>
	</head>
	<body>
		<div class="main-layout">
			<div class="sidebar">
				<div class="sidebar-content">
					<div class="album__artwork-container">
						<h1 class="album__title">Logan, <span>from The Internet</span></h1>
						<h2 class="album__artist">
						<span>F</span><span>o</span><span>r</span><span>m</span><span>e</span><span>r</span><span>&nbsp;</span><span>T</span><span>e</span><span>e</span><span>n</span><span>a</span><span>g</span><span>e</span><span>&nbsp;</span><span>B</span><span>i</span><span>g</span><span>&nbsp;</span><span>D</span><span>e</span><span>a</span><span>l</span>
					</h2>
					</div>

					<div class="currently-playing" id="currentlyPlaying">
						<div class="player__controls">
							<div class="player__controls-top">
							  <button class="player__control-btn" id="prevButton">PREV</button>
							  <button class="player__control-btn player__control-btn--play" id="playButton">PLAY</button>
							  <button class="player__control-btn" id="nextButton">NEXT</button>
							</div>
							<div class="player__controls-bottom">
								<button class="player__control-btn player__control-btn--download" id="downloadButton">FREE <s>PIRATED</s> DOWNLOADS</button>
							  </div>
							<div class="player__controls-middle">
							  <div class="player__progress-bar" id="progressBar">
								<div class="player__progress-fill" id="progressFill"></div>
							  </div>
							  <div class="player__time-display" id="timeDisplay">0:00</div>
							</div>

						  </div>
						<div class="currently-playing__header">
							<div class="currently-playing__header-title">Currently Playing</div>
						</div>
						<div class="currently-playing__content">
							<div class="currently-playing__track-info" id="currentTrackInfo">
								<div class="currently-playing__track-title" id="currentTrackTitle">Select a track or press play</div>
							</div>
						</div>
					</div>
					
					<div class="tracklist">
						{tracksWithLyrics.map((track) => (
							<div class="track" data-track-id={track.id}>
								<div class="track__number">{track.id}</div>
								<div class="track__info">
									<div class="track__title">{track.title}</div>
								</div>
								<div class="track__duration">{track.duration}</div>
							</div>
						))}
					</div>
				</div>
			</div>
			
			<div class="main-content">
				<div class="lyrics__container" id="lyricsContainer">
					<div class="lyrics__header">
						<h3 id="lyricsTitle">Welcome!</h3>
					</div>
					<div class="lyrics__content" id="lyricsContent">
						<div class="lyrics__text lyrics__text--default" id="lyricsText-default" set:html={defaultLyricsHtml}>
						</div> 
						{tracksWithLyrics.map((track, index) => (
							<div 
								class="lyrics__text hidden" 
								id={`lyricsText-${track.id}`}
								data-track-id={track.id}
								set:html={track.lyricsHtml}
							>
							</div>
						))}
					</div>
				</div>
			</div>
			
			<div class="footer">
				<!--<button class="footer__accessibility-btn" id="accessibilityToggle" aria-label="Toggle accessibility mode hidden">
					Accessibility Mode
				</button> -->
				<div class="footer__text">This site is best viewed with either Microsoft Internet Explorer 3.0 or Higher or Netscape Navigator 3.0 or Higher</div>
			</div>
		</div>

		<script src="/js/main.bundle.js" is:inline></script>
		<Analytics />
	</body>
</html>
